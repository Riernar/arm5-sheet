//- Helpers

//- Load the PUG-side code of the helpers
//- The require() node.js function needs to be passed into the PUG when calling the PUG compiler
//- This is done in generate.js, called by `npm run start|build` (see package.json)
- arm5.helpers = require("./source/helpers/helpers.pug.js").helpers;




//- Allows to transfer data from the PUG runtime to the sheet runtime
mixin transfer_data_to_sheet(destination, data)
    | // Data that was created during sheet building and persisted
    | !{destination} = !{JSON.stringify(data, null, 2)};



//- Alert are call-outs/admonition

mixin alerts({name})
    - name = actionButtonName(replaceProblems(name));
    - attributes.class = attributes.class ? ` ${replaceProblems(attributes.class)}` : '';
    - attributes.class = `kalerts kalerts--${name} kalerts__container kalerts--${name}__container`;
    div&attributes(attributes)
        +fieldset({name: `alerts--${name}`})
            +hidden({name: "level", value: "info", class: `kalerts kalerts--${name} kalerts__level kalerts--${name}__level`})
            div(class=`kalerts kalerts--${name} kalerts__content kalerts--${name}__content`)
                span(class=`kalerts kalerts--${name} kalerts__title kalerts--${name}__title`)
                    +text({name: "title", readonly: true, value: "title"})
                +adaptiveTextarea({name: "text", readonly: true, class:`kalerts kalerts--${name} kalerts__text kalerts--${name}__text`})
                +action({name: "close", class:`kalerts kalerts--${name} kalerts__close kalerts--${name}__close`, trigger: {triggeredFuncs: ["helpers.alerts.close"]}})




mixin markdown({file, string})
    - const renderer = require("markdown-it")({"html": true});
    if file
        -
            const fs = require("fs");
            if (! fs.existsSync(file)) { throw new Error(`${file} doesn't exists`); }
            const markdown = renderer.render(fs.readFileSync(file, "utf8"));
    if string
        - const markdown = renderer.render(string);
    if markdown
        div.markdown
            != markdown



//- The +module() mixin comes from k-scaffold: https://kurohyou-studios.github.io/k-scaffold/pug#module
//- It let us schedule PUG code to be run when injecting sheetworker source code into the sheet
+module
    //- Include the sheet-side source code of our helpers
    include helpers.sheet.js
